---
title: C++ Virtual Functions (behind the scenes)
author: Chan Jian Le
date: 2023-08-13 10:36:23 +0800
categories: [Programming]
tags: [programming, cpp]
---

> This article is a dive into how virtual functions work in C++ behind the scenes.
> It explains some caveats we should have in mind when deciding whether to use it.

## Nature of Virtual Function
Due to the nature of virtual functions, there are some drawbacks compares to non-virtual functions.
- Virtual function's address is not known at compile time
- The program needs to look up the virtual function’s address at runtime (no optimization can be done)
- Virtual function’s address lookup is done through virtual table pointer

![vtables](../resources/2023-08-13-prgramming-cpp-virtual-function/vtables.png)
_vtables_

![vptr](../resources/2023-08-13-prgramming-cpp-virtual-function/vptr.png)
_vptr_

## Initial Analysis


## Tips

Reason to use virtual functions:
- Virtual functions ensure that the correct function is called for an object, regardless of the type of reference (or pointer) used for the function call.
- They are mainly used to achieve `Runtime polymorphism`.
- The resolving of a function call is done at runtime.

Others:
- Virtual functions cannot be static.
- A virtual function can be a friend function of another class.
- Virtual functions should be accessed using a pointer or reference of base class type to achieve runtime polymorphism.
- The prototype of virtual functions should be the same in the base as well as the derived class.
- They are always defined in the base class and overridden in a derived class. It is not mandatory for the derived class to override (or re-define the virtual function), in that case, the base class version of the function is used.
- A class may have a virtual destructor but it cannot have a virtual constructor.

## References

Most of the article is based on Ivica Bogosavljevic talks along with some other resources.
- https://github.com/CppCon/CppCon2022/blob/main/Presentations/CppCon-The-Hidden-Performance-Price-of-Virtual-Functions.pdf
- https://www.geeksforgeeks.org/virtual-function-cpp
- https://www.geeksforgeeks.org/virtual-destructor
- https://www.geeksforgeeks.org/cpp-polymorphism
